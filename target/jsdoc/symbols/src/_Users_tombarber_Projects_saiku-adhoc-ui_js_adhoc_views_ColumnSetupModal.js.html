<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/**
<span class='line'>  2</span>  * Dialog for column setup
<span class='line'>  3</span> 
<span class='line'>  4</span> var ColumnSetupModal = Modal.extend({
<span class='line'>  5</span>     type: "selections",
<span class='line'>  6</span>     
<span class='line'>  7</span>     buttons: [
<span class='line'>  8</span>         { text: "Save", method: "save" },
<span class='line'>  9</span>         { text: "Cancel", method: "close" }
<span class='line'> 10</span>     ],
<span class='line'> 11</span>     
<span class='line'> 12</span>     events: {
<span class='line'> 13</span>         'click a': 'call',
<span class='line'> 14</span>         'change #show_unique': 'show_unique'
<span class='line'> 15</span>     },
<span class='line'> 16</span>     
<span class='line'> 17</span>     initialize: function(args) {
<span class='line'> 18</span>         // Initialize properties
<span class='line'> 19</span>         _.extend(this, args);
<span class='line'> 20</span>         this.options.title = "Selections for " + this.name;
<span class='line'> 21</span>         this.message = "Fetching members...";
<span class='line'> 22</span>         _.bindAll(this, "fetch_members", "populate");
<span class='line'> 23</span>         
<span class='line'> 24</span>         // Bind selection handlers
<span class='line'> 25</span>         _.extend(this.events, {
<span class='line'> 26</span>             'click div.selection_buttons a.form_button': 'move_selection'
<span class='line'> 27</span>         });
<span class='line'> 28</span>         
<span class='line'> 29</span>         // Determine axis
<span class='line'> 30</span>         this.axis = "undefined"; 
<span class='line'> 31</span>         if (args.target.parents('.fields_list_body').hasClass('rows')) { 
<span class='line'> 32</span>             this.axis = "ROWS";
<span class='line'> 33</span>         }
<span class='line'> 34</span>         if (args.target.parents('.fields_list_body').hasClass('columns')) { 
<span class='line'> 35</span>             this.axis = "COLUMNS";
<span class='line'> 36</span>         }
<span class='line'> 37</span>         if (args.target.parents('.fields_list_body').hasClass('filter')) { 
<span class='line'> 38</span>             this.axis = "FILTER";
<span class='line'> 39</span>         }
<span class='line'> 40</span>         
<span class='line'> 41</span>         // Resize when rendered
<span class='line'> 42</span>         this.bind('open', this.post_render);
<span class='line'> 43</span>         this.render();
<span class='line'> 44</span>         
<span class='line'> 45</span>         // Fetch available members
<span class='line'> 46</span>         this.member = new Member({}, {
<span class='line'> 47</span>             cube: args.workspace.selected_cube,
<span class='line'> 48</span>             dimension: args.key
<span class='line'> 49</span>         });
<span class='line'> 50</span>         this.member.fetch({
<span class='line'> 51</span>             success: this.fetch_members
<span class='line'> 52</span>         });
<span class='line'> 53</span>     },
<span class='line'> 54</span>     
<span class='line'> 55</span>     fetch_members: function(model, response) {
<span class='line'> 56</span>         this.available_members = response;
<span class='line'> 57</span> 
<span class='line'> 58</span>         this.workspace.query.action.get("/axis/" + this.axis + "/", { 
<span class='line'> 59</span>             success: this.populate 
<span class='line'> 60</span>         });
<span class='line'> 61</span>     },
<span class='line'> 62</span>     
<span class='line'> 63</span>     populate: function(model, response) {
<span class='line'> 64</span>         try {
<span class='line'> 65</span>             // Load template
<span class='line'> 66</span>             $(this.el).find('.dialog_body')
<span class='line'> 67</span>                 .html(_.template($("#template-selections").html())(this));
<span class='line'> 68</span>             
<span class='line'> 69</span>             this.selected_members = _.detect(response, function(obj) {
<span class='line'> 70</span>                 return obj.name == this.member.dimension;
<span class='line'> 71</span>             }, this).selections;
<span class='line'> 72</span>             var used_members = [];
<span class='line'> 73</span>     
<span class='line'> 74</span>             // Populate both boxes
<span class='line'> 75</span>             $(this.el).find('.used_selections select').removeAttr('disabled');
<span class='line'> 76</span>             for (var j = 0; j &lt; this.selected_members.length; j++) {
<span class='line'> 77</span>                 var member = this.selected_members[j];
<span class='line'> 78</span>                 if (member.levelUniqueName == this.member.level &&
<span class='line'> 79</span>                     member.type == "MEMBER") {
<span class='line'> 80</span>                     $("&lt;option />").text(member.name)
<span class='line'> 81</span>                         .val(member.uniqueName)
<span class='line'> 82</span>                         .appendTo($(this.el).find('.used_selections select'));
<span class='line'> 83</span>                     used_members.push(member.name);
<span class='line'> 84</span>                 }
<span class='line'> 85</span>             }
<span class='line'> 86</span>             
<span class='line'> 87</span>             // Filter out used members
<span class='line'> 88</span>             this.available_members = _.select(this.available_members, function(obj) {
<span class='line'> 89</span>                 return used_members.indexOf(obj.name) === -1;
<span class='line'> 90</span>             });
<span class='line'> 91</span>             
<span class='line'> 92</span>             $(this.el).find('.available_selections select').removeAttr('disabled');
<span class='line'> 93</span>             for (var i = 0; i &lt; this.available_members.length; i++) {
<span class='line'> 94</span>                 var member = this.available_members[i];
<span class='line'> 95</span>                 $("&lt;option />").text(member.name)
<span class='line'> 96</span>                     .val(member.uniqueName)
<span class='line'> 97</span>                     .appendTo($(this.el).find('.available_selections select'));
<span class='line'> 98</span>             }
<span class='line'> 99</span>         } catch (e) {
<span class='line'>100</span>             $(this.el).html("Could not load selections");
<span class='line'>101</span>         }
<span class='line'>102</span>         
<span class='line'>103</span>         // Show dialog
<span class='line'>104</span>         Saiku.ui.unblock();
<span class='line'>105</span>     },
<span class='line'>106</span>     
<span class='line'>107</span>     post_render: function(args) {
<span class='line'>108</span>         $(args.modal.el).parents('.ui-dialog').css({ width: "500px" });
<span class='line'>109</span>     },
<span class='line'>110</span>     
<span class='line'>111</span>     move_selection: function(event) {
<span class='line'>112</span>         var action = $(event.target).attr('id');
<span class='line'>113</span>         var $to = action.indexOf('add') !== -1 ? 
<span class='line'>114</span>             $(this.el).find('.used_selections select') :
<span class='line'>115</span>             $(this.el).find('.available_selections select');
<span class='line'>116</span>         var $from = action.indexOf('add') !== -1 ? 
<span class='line'>117</span>             $(this.el).find('.available_selections select') :
<span class='line'>118</span>             $(this.el).find('.used_selections select');
<span class='line'>119</span>         var $els = action.indexOf('all') !== -1 ? 
<span class='line'>120</span>             $from.find('option') :$from.find('option:selected');
<span class='line'>121</span>         $els.detach().appendTo($to);
<span class='line'>122</span>     },
<span class='line'>123</span>     
<span class='line'>124</span>     show_unique: function() {
<span class='line'>125</span>         $.each($(this.el).find('option'), function(i, option) {
<span class='line'>126</span>             var text = $(option).text();
<span class='line'>127</span>             $(option).text($(option).val());
<span class='line'>128</span>             $(option).val(text);
<span class='line'>129</span>         });
<span class='line'>130</span>     },
<span class='line'>131</span>     
<span class='line'>132</span>     save: function() {
<span class='line'>133</span>         this.close();
<span class='line'>134</span>     }
<span class='line'>135</span> });
<span class='line'>136</span>  */</span></pre></body></html>